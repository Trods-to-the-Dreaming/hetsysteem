{{#block "title"}}Wachtwoord wijzigen{{/block}}

<div class="container-compact">
	<h1>Wachtwoord wijzigen</h1>

	{{#if change_saved}}
		<p id="change-saved" class="success">{{change_message}}</p>
	{{else}}
		<form id="change-password-form" method="POST" action="/account/change-password">
			<div class="field">
				<label for="current-password-input" class="form-label">Huidige wachtwoord:</label>
				<input id="current-password-input" class="form-control" type="password" name="currentPassword" required>
			</div>
			
			<p id="password-error" class="error">{{passwordError}}</p>
			
			<div class="field">
				<label for="new-password-input" class="form-label">Nieuw wachtwoord:</label>
				<input id="new-password-input" class="form-control" type="password" name="newPassword" required>
			</div>
			
			<div class="field">
				<label for="confirmed-new-password-input" class="form-label">Bevestig nieuw wachtwoord:</label>
				<input id="confirmed-new-password-input" class="form-control" type="password" name="confirmedNewPassword" required>
			</div>
			
			<button class="button-1" type="submit">Bewaren</button>
		</form>
	{{/if}}
	
	<a class="button-up" href="/account">â†‘ Annuleren</a>
</div>

<script>
//--- Event handlers ----------------------------------------------------------------------------//
function clearPasswordError() {
	const passwordError = document.getElementById('password-error');
	passwordError.textContent = '';
}

function clearConfirmationError() {
	const confirmedNewPassword = document.getElementById('confirmed-new-password-input');
	confirmedNewPassword.setCustomValidity('');
}

function handleFormSubmit(e) {
	const newPassword = document.getElementById('new-password-input');
	const confirmedNewPassword = document.getElementById('confirmed-new-password-input');
	const form = document.getElementById('change-password-form');
	
	if (confirmedNewPassword.value && 
		newPassword.value !== confirmedNewPassword.value) {
		confirmedNewPassword.setCustomValidity('De wachtwoorden komen niet overeen.');
	} else {
		confirmedNewPassword.setCustomValidity('');
	}
	
	if (!form.checkValidity()) {
		e.preventDefault();
		form.reportValidity();
	}
}

//--- DOM content loaded ------------------------------------------------------------------------//
document.addEventListener('DOMContentLoaded', () => {
	const currentPassword = document.getElementById('current-password-input');
	const confirmedNewPassword = document.getElementById('confirmed-new-password-input');
	const form = document.getElementById('change-password-form');
	
	currentPassword.addEventListener('input', clearPasswordError);
	confirmedNewPassword.addEventListener('input', clearConfirmationError);
	form.addEventListener('submit', handleFormSubmit);
});
</script>